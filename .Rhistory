library(effects)
wine <- read_csv("winequalityN.csv")
summary(wine)
head(wine)
wine |>
group_by(ID) |>
summarise(n = n()) |>
filter(n > 1L)
sum(is.na(wine))
wine |>
filter(if_any(everything(),is.na))
colSums(is.na(wine))
mcar_test(wine |> select(fixed_acidity:quality))
sum(is.na(wine)) / nrow(wine) * 100
# Less than 1% of all observations contain missing values.
wine <- na.omit(wine)
unique(wine$quality)
# Creating quality levels
quality_levels <- c("3", "4", "5", "6", "7", "8", "9")
wine <- wine |>
mutate(quality = factor(quality, levels = quality_levels)) |>
rename(quality_score = quality)
rm(quality_levels)
clr_score <- c(
"3" = "#8B0000",
"4" = "#B22222",
"5" = "#FF8C00",
"6" = "#FFBF00",
"7" = "#9ACD32",
"8" = "#32CD32",
"9" = "#008000"
)
wine |>
ggplot(aes(x = quality_score)) +
geom_bar(
aes(fill = quality_score),
alpha = 0.7,
show.legend = FALSE
) +
geom_text(
stat = "count",
aes(label = after_stat(count)),
vjust = -0.3
) +
theme_minimal() +
labs(
x = "Wine Quality Score",
y = "Wine Count"
) +
scale_fill_manual(
values = clr_score
) +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text    = element_text(size = 12)
)
wine <- wine |>
mutate(
quality_category = case_when(
quality_score %in% c("3", "4", "5") ~ "bad",
quality_score %in% c("7", "8", "9") ~ "good",
quality_score == "6" ~ "average",
),
quality_category = factor(
quality_category,
levels = c("bad", "average", "good")
)
)
clr_category <- c(
"bad"     =  "#CC5500",
"average" =  "#FFBF00",
"good"    =  "#4CAF50"
)
wine |>
ggplot(aes(x = quality_category)) +
geom_bar(
aes(fill = quality_category),
alpha = 0.7,
show.legend = FALSE
) +
geom_text(
stat = "count",
aes(label = after_stat(count)),
vjust = -0.3
) +
theme_minimal() +
labs(
x = "Wine Quality Group",
y = "Wine Count"
) +
scale_fill_manual(
values = clr_category
) +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text    = element_text(size = 12)
)
unique(wine$type)
wine <- wine |>
mutate(type = factor(type))
wine |>
group_by(type) |>
summarise(
wine_count = n(),
wine_prop = wine_count/6497
)
wine |>
mutate(type = if_else(type == "red", "Red Wine", "White Wine")) |>
ggplot(aes(x = quality_category)) +
geom_bar(
aes(fill = quality_category),
alpha = 0.8,
show.legend = FALSE
) +
facet_wrap(~type) +
geom_text(
stat = "count",
aes(label = after_stat(count)),
vjust = -0.3
) +
theme_minimal() +
scale_fill_manual(values = clr_category) +
labs(
x = "Wine Quality Category",
y = "Overall Wine Count"
) +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text    = element_text(size = 12),
strip.text   = element_text(size = 12)
)
wine$split <- interaction(wine$type, wine$quality_score)
set.seed(123)
split <- initial_split(wine, prop = 0.8, strata = split)
train <- training(split)
test  <- testing(split)
rm(split)
train <- train |>
select(-quality_score, -split)
test <- test |>
select(-quality_score, -split)
train |>
mutate(type = if_else(type == "red", "Red Wine", "White Wine")) |>
ggplot(aes(x = quality_category)) +
geom_bar(
aes(fill = quality_category),
alpha = 0.8,
show.legend = FALSE
) +
facet_wrap(~type) +
geom_text(
stat = "count",
aes(label = after_stat(count)),
vjust = -0.3
) +
theme_minimal() +
scale_fill_manual(values = clr_category) +
labs(
x = "Wine Quality Category",
y = "EDA/Modelling Wine Count"
) +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text    = element_text(size = 12),
strip.text   = element_text(size = 12)
)
tidy_train <- train |>
pivot_longer(
cols = fixed_acidity:alcohol,
names_to = "property_name",
values_to = "property_value"
)
# Creating new property labels:
property_labels <- c(
alcohol = "Alcohol Percentage by Volume",
chlorides = "Sodium Chloride (g/L)",
citric_acid = "Citric Acid (g/L)",
density = "Density (g/cm3)",
fixed_acidity = "Fixed Acidity (g/L)",
free_sulfur_dioxide = "Free Sulphur Dioxide (mg/L)",
total_sulfur_dioxide = "Total Sulphur Dioxide (mg/L)",
pH = "pH",
residual_sugar = "Sugar (g/L)",
sulphates = "Potassium Sulphate (g/L)",
volatile_acidity = "Volatile Acidity (g/L)"
)
# Replacing old property labels with the new ones:
tidy_train <- tidy_train |>
mutate(property_name = property_labels[property_name])
# Creating property levels:
# (I want them in specific order - e.g., variables that relate to
# acidity grouped together).
property_order <- c(
"Volatile Acidity (g/L)",
"Fixed Acidity (g/L)",
"Citric Acid (g/L)",
"pH",
"Free Sulphur Dioxide (mg/L)",
"Total Sulphur Dioxide (mg/L)",
"Potassium Sulphate (g/L)",
"Sodium Chloride (g/L)",
"Sugar (g/L)",
"Density (g/cm3)",
"Alcohol Percentage by Volume"
)
tidy_train <- tidy_train |>
mutate(
property_name = factor(property_name, levels = property_order)
)
tidy_train |>
ggplot(aes(x = property_value)) +
geom_histogram() +
facet_wrap(
~property_name,
scales = "free",
nrow = 4
) +
labs(
y = "Wine Count",
x = "Physicochemical Property Value"
) +
theme_minimal() +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text    = element_text(size = 11),
strip.text   = element_text(size = 11)
)
tidy_train |>
ggplot(aes(x = factor(1), y = property_value)) +
geom_boxplot(width = 0.7) +
facet_wrap(
~property_name,
scales = "free_y",
nrow = 4
) +
labs(
y = "Physicochemical Property Value"
) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_text(size = 12),
axis.text.y  = element_text(size = 11),
axis.text.x  = element_blank(),
strip.text   = element_text(size = 11)
)
ws_train <- train |>
group_by(type) |>
mutate(across(
fixed_acidity:alcohol,
~Winsorize(.,val = quantile(., probs = c(0.05, 0.95)))
)
) |>
ungroup()
ws_tidy_train <- ws_train |>
pivot_longer(
cols = fixed_acidity:alcohol,
names_to = "property_name",
values_to = "property_value"
)
ws_tidy_train <- ws_tidy_train |>
mutate(property_name = property_labels[property_name])
ws_tidy_train <- ws_tidy_train |>
mutate(
property_name = factor(property_name, levels = property_order)
)
ws_tidy_train |>
# Select which group of wine - "red" or "white" - to investigate:
filter(type == "white") |>
ggplot(aes(x = factor(1), y = property_value)) +
geom_boxplot(width = 0.7) +
facet_wrap(
~property_name,
scales = "free_y",
nrow = 4
) +
labs(
y = "Physicochemical Property Value"
) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_text(size = 12),
axis.text.y  = element_text(size = 11),
axis.text.x  = element_blank(),
strip.text   = element_text(size = 11)
)
# Select if you want to visualise tidy data set (i.e., "tidy_train")
# or winsorized data set (i.e., "ws_tidy_train")
ws_tidy_train |>
# Select which group of wine - "red" or "white" - to investigate:
filter(type == "white") |>
ggplot(aes(x = quality_category, y = property_value)) +
geom_boxplot(
aes(fill = quality_category),
show.legend = FALSE
) +
facet_wrap(
~property_name,
scales = "free_y",
nrow = 4
) +
labs(
y = "Physicochemical Property Value",
x = "Quality Category"
) +
theme_minimal() +
scale_fill_manual(values = clr_category) +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text    = element_text(size = 11),
strip.text   = element_text(size = 11)
)
lm_model <- lm(
fixed_acidity ~ .,
# Select if you want to visualise regular or winsorized data set
# And which group of wine - "red" or "white" - to investigate:
data = select(ws_train |> filter(type == "white"), fixed_acidity:alcohol)
)
vif_values <- vif(lm_model)
vif_values
rm(list = c("lm_model", "vif_values"))
# input either "red" or "white"
tp_wine <- "red"
pca <- prcomp(
select(ws_train |>  filter(type == tp_wine), fixed_acidity:alcohol),
scale. = TRUE
)
plot(pca, type = 'l')
summary(pca)
loadings <-
pca$rotation |>
as.data.frame() |>
rownames_to_column("property_name")
loadings |>
pivot_longer(
cols = PC1:PC11,
names_to = "PC_number",
values_to = "PC_value"
) |>
mutate(property_name = property_labels[property_name]) |>
filter(PC_number %in% c("PC1", "PC2", "PC3")) |>
ggplot(aes(y = PC_value, x = property_name)) +
geom_col() +
coord_flip() +
theme_minimal() +
facet_wrap(~PC_number) +
labs(
y = "Loading Value",
x = "Physicochemical Property"
) +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text    = element_text(size = 11),
strip.text   = element_text(size = 11)
)
scores_train <-
pca$x |>
as.data.frame() |>
cbind(train |> filter(type == tp_wine))
model= polr(
quality_category ~ PC1 + PC2 + PC3 ,
data = scores_train,
Hess = TRUE
)
summary(model)
exp(cbind(OR = coef(model), confint(model)))
plot(
Effect(focal.predictors = "PC3", model),
xlab = "PC Score",
ylab = "Predicted Probability"
)
winsor_cutoffs <- apply(
select(train |>  filter(type == tp_wine), fixed_acidity:alcohol),
2,
function(x) quantile(x, probs = c(0.05, 0.95))
)
ws_test <- test |>
select(fixed_acidity:alcohol) |>
mutate(across(
fixed_acidity:alcohol,
~pmin(
pmax(
.x,
winsor_cutoffs[1, cur_column()]
),
winsor_cutoffs[2, cur_column()]
))
)
scores_test <- as.data.frame(predict(pca, newdata = ws_test)[, 1:3])
scores_test$quality_category <- test$quality_category
pred_test <- predict(model, newdata = scores_test, type = "class")
table(pred_test, scores_test$quality_category)
mean(pred_test == scores_test$quality_category)
pred_test <- predict(model, newdata = scores_test, type = "class")
table(pred_test, scores_test$quality_category)
mean(pred_test == scores_test$quality_category)
plot(
Effect(focal.predictors = "PC3", model),
xlab = "PC Score",
ylab = "Predicted Probability"
)
exp(cbind(OR = coef(model), confint(model)))
q()
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(naniar)
library(ggplot2)
library(tidymodels)
library(tidyr)
library(DescTools)
library(tibble)
library(car)
library(MASS)
library(effects)
wine <- read_csv("winequalityN.csv")
summary(wine)
head(wine)
wine |>
group_by(ID) |>
summarise(n = n()) |>
filter(n > 1L)
sum(is.na(wine))
wine |>
filter(if_any(everything(),is.na))
colSums(is.na(wine))
mcar_test(wine |> select(fixed_acidity:quality))
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(naniar)
library(ggplot2)
library(tidymodels)
library(tidyr)
library(DescTools)
library(tibble)
library(car)
library(MASS)
library(effects)
wine <- read_csv("winequalityN.csv")
summary(wine)
head(wine)
wine |>
group_by(ID) |>
summarise(n = n()) |>
filter(n > 1L)
sum(is.na(wine))
wine |>
filter(if_any(everything(),is.na))
colSums(is.na(wine))
mcar_test(wine |> select(fixed_acidity:quality))
View(wine)
mcar_test(wine |> dplyr::select(fixed_acidity:quality))
mcar_test(wine |> dplyr::select(fixed_acidity:quality))
q()
library(tidyverse)
library(janitor)
library(readxl)
library(skimr)
library(emmeans)
library(survival)
library(coin)
library(stats)
library(rstatix)
library(ggpubr)
library(patchwork)
library(grid)
# Before creating a function, I make some preparations.
# First, I point R to the folder where my data are stored.
# In my case, I have a folder called "raw_data" in the working directory:
data_dir <- "raw_data"
# Next, I list all the .txt files in that folder.
# Each .txt file corresponds to a single participant and contains data on their
# verbal communication:
data_files <- list.files(data_dir, pattern = "\\.txt$", full.names = TRUE)
# All .txt files follow the same structure and share the same column names:
column_names <- c("measurement", "programme_version", "start", "finish", "length", "type")
# Finally, I create an empty list to temporarily store each participant's data:
participant_data <- list()
# Now that I have everything ready, I write a function to loop through each file,
# apply column names, add participant ID, and import the data into the list:
for (file in data_files) {
# Read the data and apply column names:
data <- read.table(file, header = FALSE, sep = "\t", col.names = column_names)
# Extract the participant ID by removing the '.txt' extension from the file name:
participant_id <- gsub("\\.txt$", "", basename(file))
# Add a new column to track the participant ID:
data$participant_id <- participant_id
# Store the cleaned data in the list:
participant_data[[participant_id]] <- data
}
# Then, I combine all individual data frames into one large data frame:
communication <- do.call(rbind, participant_data)
# and reset row names for clarity:
rownames(communication) <- NULL
# Weâ€™ve got our data imported. Perfect!
# Before finishing up, I remove the intermediate variables to keep things neat and nice:
rm(list = c("data", "participant_data", "column_names", "data_dir", "data_files",
"file", "participant_id"))
rapport <- read_excel("raw_data/demo_rapport.xlsx") |>
# clean_names(): makes sure the variable names are clean and
# follow a consistent format:
clean_names()
write_csv(communication, "communication_test.csv")
